<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SEIR-vector Model - Overview</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">SEIR-vector Model</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./overview.html" aria-current="page">
 <span class="menu-text">Overview</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Page Contents</h2>
   
  <ul>
  <li><a href="#workflow-synopsis" id="toc-workflow-synopsis" class="nav-link active" data-scroll-target="#workflow-synopsis">Workflow Synopsis</a></li>
  <li><a href="#parameters-and-formula" id="toc-parameters-and-formula" class="nav-link" data-scroll-target="#parameters-and-formula">Parameters and Formula</a></li>
  <li><a href="#model-preliminaries" id="toc-model-preliminaries" class="nav-link" data-scroll-target="#model-preliminaries">Model Preliminaries</a>
  <ul class="collapse">
  <li><a href="#needed-libraries" id="toc-needed-libraries" class="nav-link" data-scroll-target="#needed-libraries">Needed Libraries</a></li>
  <li><a href="#observed-incidence" id="toc-observed-incidence" class="nav-link" data-scroll-target="#observed-incidence">Observed Incidence</a></li>
  <li><a href="#exploratory-model" id="toc-exploratory-model" class="nav-link" data-scroll-target="#exploratory-model">Exploratory Model</a></li>
  </ul></li>
  <li><a href="#bayesian-model" id="toc-bayesian-model" class="nav-link" data-scroll-target="#bayesian-model">Bayesian Model</a>
  <ul class="collapse">
  <li><a href="#prior-model" id="toc-prior-model" class="nav-link" data-scroll-target="#prior-model">Prior Model</a></li>
  <li><a href="#full-bayesian-model" id="toc-full-bayesian-model" class="nav-link" data-scroll-target="#full-bayesian-model">Full Bayesian Model</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Overview</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<style type="text/css">

body, td {
   font-size: 13pt;
}
code.r{
  font-size: 9pt;
}
pre {
  font-size: 11pt
}
</style>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Draft Supporting Information (<em>in review</em>)
</div>
</div>
<div class="callout-body-container callout-body">
<p>This site provides a demonstrative workflow and supporting information for the publication:<br>
<strong>Mechanistic Insights into the 2014-2015 Vesicular Stomatitis Outbreak in the United States: A SEIR-SEI Compartmental Model Analysis</strong></p>
<p>Authors:<br>
Humphreys, Pelzel-McCluskey, Shults, Velazquez Salinas, Bertram, McGregor, Cohnstaedt, Swanson, Scroggs, Peters, and Rodriguez</p>
</div>
</div>
<div class="callout-tip callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
External Resources
</div>
</div>
<div class="callout-body-container callout-body">
<p>An interactive dashboard to demonstrate the described SEIR-SEI model is available: <a href="https://geoepi.shinyapps.io/seir-vector/">ShinyApps: https://geoepi.shinyapps.io/seir-vector/</a></p>
<p>Code for this site and ShinyApp above are available:<br>
<a href="https://github.com/geoepi/seir-vector">GitHub: https://github.com/geoepi/seir-vector</a></p>
<p>Large model objects, incidence data, and other archived information are available on the Open Science Framework: <a href="https://osf.io/vqgxs/">Project OSF site: https://osf.io/vqgxs/</a>. The R-function <em>get_data_osf()</em> is provided to download and load these data as needed.</p>
</div>
</div>
<section id="workflow-synopsis" class="level2">
<h2 class="anchored" data-anchor-id="workflow-synopsis">Workflow Synopsis</h2>
<p>This script provides an overview of the methodologies and code presented in the publication above. Note that data, code, and website configuration files, as well as code for the <a href="https://geoepi.shinyapps.io/seir-vector/">VSV ShinyApp</a>, are available on the project’s <a href="https://github.com/geoepi/seir-vector">GitHub site</a> and <a href="https://osf.io/vqgxs/">OSF Project site</a>. Executed Stan model objects are approximately 200mb in size, code to download and read these objects is provided in the script.</p>
<p>For simplicity, this workflow will demonstrate analysis for outbreaks observed in 2014, however the workflow can be applied to 2015 outbreaks with minimal modification. The PAGE CONTENTS menu in the right upper corner can be used to navigate to specific sections.</p>
</section>
<section id="parameters-and-formula" class="level2">
<h2 class="anchored" data-anchor-id="parameters-and-formula">Parameters and Formula</h2>
<section id="model-parameters" class="level4">
<h4 class="anchored" data-anchor-id="model-parameters">Model Parameters</h4>
Brief descriptions of parameters used in the model. Note that additional information and cited sources for selected parameter values are provided in the associated publication.<br>
<br>

<span class="math display">\begin{array}{|c|l|}
  \hline
  \text{Parameter} &amp; \text{Description} \\
  \hline
  N_h &amp; \text{Total number of vertebrate hosts} \\
  N_v &amp; \text{Total number of insect vectors} \\
  \upsilon_h &amp; \text{Contact rate, bites sustained by host} \\
  \upsilon_v &amp; \text{Contact rate, vector biting rate} \\
  \beta_h &amp; \text{Vector to host transmission probability} \\
  \beta_v &amp; \text{Host to vector transmission probability}  \\
  \sigma_h &amp; \text{Intrinsic Incubation Period (IIP)} \\
  \sigma_v &amp; \text{Extrinsic Incubation Period (EIP)} \\
  \gamma_h &amp; \text{Host removal rate (recovery or quarantine)} \\
  \rho_h &amp; \text{Host heterogeneous competency} \\
  \rho_v &amp; \text{Vector heterogeneous competency} \\
  \mu_v &amp; \text{Vector background mortality rate} \\
  \kappa &amp; \text{Observation bias (proportion observed)} \\
  \hline
\end{array}</span>
<p><br>
</p>
</section>
<section id="model-specification" class="level4">
<h4 class="anchored" data-anchor-id="model-specification">Model Specification</h4>
<p>Mechanistic aspects of the model can can be diagrammatically represented as shown below. Note that in case of both the vertebrate hosts (<span class="math inline">h</span> subscript) and vectors (<span class="math inline">v</span> subscript), the term <span class="math inline">\rho</span> influences the number of exposed individuals (<strong>E</strong>) that proceed to the infectiousness compartment (<strong>I</strong>).</p>
<p><img src="images/diagram.png" style="width:75.0%"></p>
<p><strong>More formally, the model is given as: </strong></p>
<p><span id="eq-seirsei"><span class="math display">\begin{align}
    \lambda_h &amp;= \upsilon_h \cdot \beta_h \cdot \frac{I_v}{N_v} \\
    \lambda_v &amp;= \upsilon_v \cdot \beta_v \cdot \frac{I_h}{N_h} \\
    \frac{dS_h}{dt} &amp;= -\lambda_h \cdot S_h \\
    \frac{dE_h}{dt} &amp;=  \lambda_h \cdot S_h - \sigma_h \cdot E_h \\
    \frac{dI_h}{dt} &amp;= \sigma_h \cdot E_h \cdot \rho_h - \gamma_h \cdot I_h \\
    \frac{dR_h}{dt} &amp;=  \gamma_h \cdot I_h  \\
    \frac{dS_v}{dt} &amp;= \mu_v \cdot N_v - \lambda_v \cdot S_v - \mu_v \cdot S_v \\
    \frac{dE_v}{dt} &amp;= \lambda_v \cdot S_v - (\sigma_v + \mu_v) \cdot E_v \\
    \frac{dI_v}{dt} &amp;=  \sigma_v \cdot E_v \cdot \rho_v - \mu_v \cdot I_v \\ \nonumber
\end{align} \tag{1}</span></span></p>
<p><strong>in which the first two lines give the Force of Infection (FOI, <span class="math inline">\lambda</span>’s) for hosts and vectors respectively</strong> and <span class="math inline">\rho</span> parameters (range 0.00-1.00) potentially reduce the size of the exposed (<strong>E</strong>) populations used in calculating the number of infectious individuals (<strong>I</strong>).</p>
</section>
</section>
<section id="model-preliminaries" class="level2">
<h2 class="anchored" data-anchor-id="model-preliminaries">Model Preliminaries</h2>
<p>Before constructing a Bayesian model in Stan (<a href="https://mc-stan.org/users/interfaces/">Stan Installation</a>), we first visualize the data and construct an exploratory compartmental model using non-Bayesian Ordinary Differential Equations (ODE) and the <strong>deSolve</strong> Package.</p>
<section id="needed-libraries" class="level3">
<h3 class="anchored" data-anchor-id="needed-libraries">Needed Libraries</h3>
<p>Load needed R-Packages and custom functions.</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here) <span class="co"># to manage directories</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># data wrangling</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(deSolve) <span class="co"># for exploratory models</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist) <span class="co"># visualizations</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan) <span class="co"># interface with Stan from R</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>) <span class="co"># options</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr) <span class="co"># additional Stan options in R</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">check_cmdstan_toolchain</span>(<span class="at">fix =</span> <span class="cn">TRUE</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">register_knitr_engine</span>()</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># custom functions (mostly plotting)  </span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"./R/utilities.R"</span>))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">source_dir</span>(<span class="st">"./R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="observed-incidence" class="level3">
<h3 class="anchored" data-anchor-id="observed-incidence">Observed Incidence</h3>
<p>Read observed incidence data as a data frame called <em>truth_df</em> and create a simple plot figure. Note that 2014 and 2015 data are available in the <em>vsv_ind_truth.rds</em> object.</p>
<section id="contents-for-truth_df" class="level5">
<h5 class="anchored" data-anchor-id="contents-for-truth_df">Contents for <em>truth_df</em></h5>
<ul>
<li>date: Estimated date of disease onset (symptoms) as determined by examination at time of inspection.<br>
</li>
<li>count: Number of individuals animals with Vesicular Stomatitis (VS)<br>
</li>
<li>susc: Number of individual animals located with same herd or on same premises as confirmed animal. These values are assumed to reflect susceptible animals.<br>
</li>
<li>year: Year of confirmed VS onset.<br>
</li>
<li>doy: Integer 1-365 reflecting the day of year for the <em>date</em>.</li>
</ul>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>truth_df <span class="ot">&lt;-</span> <span class="fu">get_data_osf</span>(<span class="st">"vs_inc_truth"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2014</span>) <span class="co"># change to 2015 to examine 2015 data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: httr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'httr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>File downloaded successfully and saved as vs_inc_truth.rds </code></pre>
</div>
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(truth_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   117 obs. of  5 variables:
 $ date : Date, format: "2014-05-18" "2014-05-29" ...
 $ count: int  4 1 1 1 2 1 1 2 4 1 ...
 $ susc : int  65 3 3 5 4 1 11 79 7 6 ...
 $ year : num  2014 2014 2014 2014 2014 ...
 $ doy  : num  138 149 150 158 159 163 166 174 184 188 ...</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_incidence</span>(truth_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-incidence" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="overview_files/figure-html/fig-incidence-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Observed VS incidence 2014.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="exploratory-model" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-model">Exploratory Model</h3>
<p>Before coding a Stan model, model parameters are through construction of a relatively simple Ordinary Differential Equations (ODE) model using the <strong>deSolve</strong> package. This model uses discrete, user specified values and does not incorporate uncertainty.</p>
<section id="initial-parameters" class="level5">
<h5 class="anchored" data-anchor-id="initial-parameters">Initial Parameters</h5>
<p>Parameters are describe in the Table at top of page. The specific values given in this example were arbitrarily selected from the ranges evaluated in the full model (presented later in script).</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>initial_parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_h =</span> <span class="fl">0.95</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gamma_h =</span> <span class="fl">0.10</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma_h =</span> <span class="fl">0.25</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma_v =</span> <span class="fl">0.4</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">rho_h =</span> <span class="fl">0.3</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">rho_v =</span> <span class="fl">0.85</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_v =</span> <span class="fl">0.85</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_v =</span> <span class="fl">0.1</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">upsilon_h =</span> <span class="fl">0.6</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">upsilon_v =</span> <span class="fl">0.35</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="initial-conditions" class="level5">
<h5 class="anchored" data-anchor-id="initial-conditions">Initial Conditions</h5>
<p>Initial population estimates and counts of exposed and infectious individuals.</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>N_h <span class="ot">&lt;-</span> <span class="dv">10000</span>   <span class="co"># number of vertebrate hosts</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Eh <span class="ot">&lt;-</span> <span class="dv">0</span>        <span class="co"># initial hosts exposed</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>Ih <span class="ot">&lt;-</span> <span class="dv">1</span>        <span class="co"># initial hosts infectious</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>N_v <span class="ot">&lt;-</span> <span class="dv">300</span> <span class="sc">*</span> N_h  <span class="co"># number of vectors per host</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>Ev <span class="ot">&lt;-</span> <span class="dv">0</span>        <span class="co"># initial exposed vectors</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>Iv <span class="ot">&lt;-</span> <span class="dv">1</span>        <span class="co"># initial infectious vectors</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>initial_conditions <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sh =</span> N_h <span class="sc">-</span> Eh <span class="sc">-</span> Ih,  <span class="co"># Susceptible hosts</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Eh =</span> Eh,             <span class="co"># Exposed hosts</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Ih =</span> Ih,             <span class="co"># Infectious hosts</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Rh =</span> <span class="dv">0</span>,              <span class="co"># Recovered hosts</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sv =</span> N_v <span class="sc">-</span> Iv <span class="sc">-</span> Ev,  <span class="co"># Susceptible vectors</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Ev =</span> Ev,             <span class="co"># Exposed vectors</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Iv =</span> Iv              <span class="co"># Infectious vectors</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="ode-function" class="level5">
<h5 class="anchored" data-anchor-id="ode-function">ODE Function</h5>
<p>Results from this exploratory model can be examined more thoroughly on the <a href="https://geoepi.shinyapps.io/seir-vector/">SEIR-SEI ShinyApp</a>, which uses the same underlying function as given here.</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>seirsei_ode <span class="ot">&lt;-</span> <span class="cf">function</span>(t, state, parameters) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)), {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    lambda_h <span class="ot">=</span> upsilon_h <span class="sc">*</span> beta_h <span class="sc">*</span> Iv <span class="sc">/</span> N_v</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    lambda_v <span class="ot">=</span> upsilon_v <span class="sc">*</span> beta_v <span class="sc">*</span> Ih <span class="sc">/</span> N_h</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    dSh <span class="ot">=</span> <span class="sc">-</span>lambda_h <span class="sc">*</span> Sh</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    dEh <span class="ot">=</span> lambda_h <span class="sc">*</span> Sh <span class="sc">-</span> sigma_h <span class="sc">*</span> Eh</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    dIh <span class="ot">=</span> sigma_h <span class="sc">*</span> Eh<span class="sc">*</span>rho_h <span class="sc">-</span> gamma_h <span class="sc">*</span> Ih</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    dRh <span class="ot">=</span> gamma_h <span class="sc">*</span> Ih</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    dSv <span class="ot">=</span> mu_v <span class="sc">*</span> N_v <span class="sc">-</span> lambda_v <span class="sc">*</span> Sv <span class="sc">-</span> mu_v <span class="sc">*</span> Sv</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    dEv <span class="ot">=</span> lambda_v <span class="sc">*</span> Sv <span class="sc">-</span> (sigma_v <span class="sc">+</span> mu_v) <span class="sc">*</span> Ev</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    dIv <span class="ot">=</span> sigma_v <span class="sc">*</span> Ev<span class="sc">*</span>rho_v <span class="sc">-</span> mu_v <span class="sc">*</span> Iv</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">c</span>(dSh, dEh, dIh, dRh, dSv, dEv, dIv)))</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="time-steps" class="level5">
<h5 class="anchored" data-anchor-id="time-steps">Time Steps</h5>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">365</span>, <span class="at">by =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="run-model" class="level5">
<h5 class="anchored" data-anchor-id="run-model">Run Model</h5>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ode</span>(<span class="at">y =</span> initial_conditions, <span class="at">times =</span> times, <span class="at">func =</span> seirsei_ode, <span class="at">parms =</span> initial_parameters)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plot-results" class="level4">
<h4 class="anchored" data-anchor-id="plot-results">Plot Results</h4>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ode_dynamics</span>(out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ode_dyn" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="overview_files/figure-html/fig-ode_dyn-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Host population dynamics from exploratory model.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_ei_incidence</span>(out, <span class="at">gamma_h=</span>initial_parameters[<span class="st">"gamma_h"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-comp_ii" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="overview_files/figure-html/fig-comp_ii-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Comparison of incident infections. Line labeled Infected indicates the number of new indiduals added to the Exposed compartment per time step, whereas the line labeled Symptomatic refers to the number of new individuals added to the infectious compartment. The ratio of the sums for the Infected and Symptomatic curves is shown as Estimated rho in the plot. This reverse calculation demonstrates what the rho competency parameter is doing in the model.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="bayesian-model" class="level2">
<h2 class="anchored" data-anchor-id="bayesian-model">Bayesian Model</h2>
<p>Having demonstrated model parameter relationships using the ODE function above, a full Bayesian model is next constructed in Stan. The Bayesian approach allows for parameters to specified based on what is currently understood about VSV hosts, vectors, and epidemiology. This done through prior distribution specifications. The Bayesian approach also provides for better accounting of uncertainty in the model.</p>
<p>In addition to translating the SEIR-SEI equations (<a href="#eq-seirsei">Equation&nbsp;1</a>) to the Stan language, a likelihood function is needed as well as incorporation of an additional <em>observation error</em> term to help account for the difference between disease cases as observed and documented and the case number (theoretically) needed to propagate the disease, assuming the model’s mechanistic parameters accurately reflect the reality of the VS epidemiology.</p>
<section id="prior-model" class="level3">
<h3 class="anchored" data-anchor-id="prior-model">Prior Model</h3>
<p>Before incorporating observed data into the model, a prior model is coded and evaluated to ensure that assumptions about prior distributions are reasonable.</p>
<section id="prior-model-code" class="level4">
<h4 class="anchored" data-anchor-id="prior-model-code">Prior model code</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">functions</span> {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// SEIR-SEI function</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>[] seirsei(<span class="dt">real</span> t, <span class="dt">real</span>[] y, <span class="dt">real</span>[] theta, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>             <span class="dt">real</span>[] x_r, <span class="dt">int</span>[] x_i) {</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> N_h = x_i[<span class="dv">1</span>];        <span class="co">// parameters are described in table above</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> beta_h = theta[<span class="dv">1</span>];</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> gamma_h = theta[<span class="dv">2</span>];</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> sigma_h = theta[<span class="dv">3</span>];</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> sigma_v = theta[<span class="dv">4</span>];</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> rho_h = theta[<span class="dv">5</span>];</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> rho_v = theta[<span class="dv">6</span>];</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> beta_v = theta[<span class="dv">7</span>];</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> mu_v = theta[<span class="dv">8</span>];</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> upsilon_h = theta[<span class="dv">9</span>];</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> upsilon_v = theta[<span class="dv">10</span>];</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> i_0 = theta[<span class="dv">11</span>];     <span class="co">// initial conditions</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> e_0 = theta[<span class="dv">12</span>];</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> ev_0 = theta[<span class="dv">13</span>];</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> iv_0 = theta[<span class="dv">14</span>];</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> N_v = theta[<span class="dv">15</span>];</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>      <span class="co">// initial compartment sizes</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> init[<span class="dv">7</span>] = {N_h - i_0 - e_0, e_0, i_0, <span class="dv">0</span>, N_v - iv_0 - ev_0, ev_0, iv_0}; </span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> Sh = y[<span class="dv">1</span>] + init[<span class="dv">1</span>]; <span class="co">// compartments</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> Eh = y[<span class="dv">2</span>] + init[<span class="dv">2</span>];</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> Ih = y[<span class="dv">3</span>] + init[<span class="dv">3</span>];</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> Rh = y[<span class="dv">4</span>] + init[<span class="dv">4</span>];</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> Sv = y[<span class="dv">5</span>] + init[<span class="dv">5</span>];</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> Ev = y[<span class="dv">6</span>] + init[<span class="dv">6</span>];</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> Iv = y[<span class="dv">7</span>] + init[<span class="dv">7</span>];</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>      <span class="co">// FORCE of Infection</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> lambda_h = upsilon_h * beta_h * Iv / N_v;</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> lambda_v = upsilon_v * beta_v * Ih / N_h;</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>      <span class="co">// differential equations</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> dS_dt = -lambda_h * Sh;</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> dE_dt =  lambda_h * Sh - sigma_h * Eh;</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> dI_dt = sigma_h * Eh*rho_h - gamma_h * Ih;</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> dR_dt =  gamma_h * Ih;</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> dSv_dt = mu_v*N_v - lambda_v*Sv - mu_v*Sv;</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> dEv_dt = lambda_v*Sv - (sigma_v + mu_v)*Ev;</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> dIv_dt =  sigma_v * Ev*rho_v - mu_v*Iv;</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> {dS_dt, dE_dt, dI_dt, dR_dt, dSv_dt, dEv_dt, dIv_dt};</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; n_days; <span class="co">// number of days</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> t0;            <span class="co">// initial step</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> ts[n_days];    <span class="co">// time steps</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> N_h;            <span class="co">// host population size</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> N_v;            <span class="co">// vector population size</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed data</span> {</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> x_r[<span class="dv">0</span>];        <span class="co">// data array</span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> x_i[<span class="dv">1</span>] = { N_h };   <span class="co">// array with host population size</span></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt; beta_h; <span class="co">// parameters, see table above</span></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; gamma_h;</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma_h;</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma_v;</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt; rho_h;</span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt; rho_v;</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt; beta_v;</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; mu_v;</span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; upsilon_h;</span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; upsilon_v;</span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; phi_inv;</span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; i_0; </span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; e_0; </span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; ev_0; </span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; iv_0; </span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed parameters</span>{</span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> y[n_days, <span class="dv">7</span>];        <span class="co">// outputs, state variables</span></span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> incidence[n_days - <span class="dv">1</span>];   <span class="co">// incidence </span></span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> phi = <span class="fl">1.</span> / phi_inv;    <span class="co">// dispersian parameter for NegBinomial</span></span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> theta[<span class="dv">15</span>] = {beta_h, gamma_h, sigma_h, sigma_v, rho_h, rho_v, beta_v, mu_v, upsilon_h, upsilon_v, i_0, e_0, ev_0, iv_0, N_v};</span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>  <span class="co">// solve ODEs using Runge-Kutta 45 integration</span></span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>  y = <span class="kw">integrate_ode_rk45</span>(seirsei, rep_array(<span class="fl">0.0</span>, <span class="dv">7</span>), t0, ts, theta, x_r, x_i);</span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>  <span class="co">// daily incidence</span></span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:n_days<span class="dv">-1</span>){</span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>    incidence[i] = -(y[i+<span class="dv">1</span>, <span class="dv">2</span>] - y[i, <span class="dv">2</span>] + y[i+<span class="dv">1</span>, <span class="dv">1</span>] - y[i, <span class="dv">1</span>]) + <span class="fl">1e-8</span>;</span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> { <span class="co">// model priors</span></span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>  beta_h ~ beta(<span class="dv">10</span>, <span class="dv">2</span>);</span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>  gamma_h ~ lognormal(log(<span class="fl">0.13</span>), <span class="fl">0.1</span>);  </span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>  sigma_h ~ lognormal(log(<span class="fl">0.12</span>), <span class="fl">0.1</span>);</span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>  sigma_v ~ lognormal(log(<span class="fl">0.4</span>), <span class="fl">0.1</span>);</span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>  rho_h ~ beta(<span class="dv">5</span>, <span class="dv">10</span>);</span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>  rho_v ~ beta(<span class="dv">10</span>, <span class="dv">2</span>); </span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>  beta_v ~ beta(<span class="dv">10</span>, <span class="dv">2</span>);</span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>  mu_v ~ lognormal(log(<span class="fl">0.1</span>), <span class="fl">0.1</span>);</span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>  upsilon_h ~ lognormal(log(<span class="fl">0.6</span>), <span class="fl">0.1</span>);</span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>  upsilon_v ~ lognormal(log(<span class="fl">0.3</span>), <span class="fl">0.1</span>);</span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>  phi_inv ~ exponential(<span class="dv">2</span>);</span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>  i_0 ~ lognormal(<span class="dv">0</span>, <span class="fl">0.1</span>);</span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>  e_0 ~ lognormal(<span class="dv">0</span>, <span class="fl">0.1</span>);</span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>  ev_0 ~ lognormal(<span class="dv">0</span>, <span class="fl">0.1</span>);</span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>  iv_0 ~ lognormal(<span class="dv">0</span>, <span class="fl">0.1</span>);</span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a><span class="kw">generated quantities</span> {</span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> duration = <span class="dv">1</span> / gamma_h; <span class="co">// disease duration</span></span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> incub_h = <span class="dv">1</span> / sigma_h;   <span class="co">// intrinsic incubation period</span></span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> incub_v = <span class="dv">1</span>/ sigma_v;    <span class="co">// extrinsic incubation period</span></span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> pred_infected[n_days<span class="dv">-1</span>];  <span class="co">// predicted incidence</span></span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>  pred_infected = neg_binomial_2_rng(incidence, phi); <span class="co">// sample from NegBinomial</span></span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="negativebinomial-sampling" class="level4">
<h4 class="anchored" data-anchor-id="negativebinomial-sampling">NegativeBinomial Sampling</h4>
<p>Note that the Stan code above includes a negative binomial distribution that samples from estimated incidence. The SEIR-SEI ODE equations estimate prevalence but not incidence. Therefore, the code first estimates incidence (new infections each day) using the susceptible (<strong>S</strong>) and exposed (<strong>E</strong>) compartments. A small value (1e-8) is included to prevent incidence from being negative on the initial iteration. The code as shown in the <code>transformed parameters</code> block is,</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:n_days<span class="dv">-1</span>){</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    incidence[i] = -(y[i+<span class="dv">1</span>, <span class="dv">2</span>] - y[i, <span class="dv">2</span>] + y[i+<span class="dv">1</span>, <span class="dv">1</span>] - y[i, <span class="dv">1</span>]) + <span class="fl">1e-8</span>;</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Later in the <code>generated quantities</code> block, incidence is used in sampling from the NgBinomial,</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">real</span> pred_infected[n_days<span class="dv">-1</span>]; </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  pred_infected = neg_binomial_2_rng(incidence, phi); </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Consdering that incidence is estimated from the daily change (<span class="math inline">\Delta \text{I}_{t}</span>) in infections (virus exposures), and this quantity is used to sample from the NegBinomial, the notation with prior distributions couldbe shown as,</p>
<p><span id="eq-negbin"><span class="math display">\begin{align} \nonumber
    \text{Y}_{t}|\theta &amp;\sim \text{NegBinomial}(\text{Y}|\Delta\text{I}_{t}, \phi) \\ \nonumber
    \theta &amp;= \{\upsilon_h,\upsilon_v, \beta_h, \beta_v, \sigma_h, \sigma_v, \gamma_h, \mu, \rho \} \\ \nonumber
    \upsilon_h &amp;\sim \text{Lognormal}(log(0.25), 0.1) \\ \nonumber
    \upsilon_v &amp;\sim \text{Lognormal}(log(0.15), 0.1) \\ \nonumber
    \beta_h &amp;\sim \text{Beta}(10, 1) \\ \nonumber
    \beta_v &amp;\sim \text{Beta}(1, 10) \\
    \sigma_h &amp;\sim \text{Lognormal}(log(0.15), 0.1) \\ \nonumber
    \sigma_v &amp;\sim \text{Lognormal}(log(0.3), 0.1) \\ \nonumber
    \rho_h &amp;\sim \text{Beta}(10, 100) \\ \nonumber
    \rho_v &amp;\sim \text{Beta}(5, 10) \\ \nonumber
    \gamma_h &amp;\sim \text{Lognormal}(log(0.085), 0.1) \\ \nonumber
    \mu &amp;\sim \text{Lognormal}(log(0.1), 0.1) \\ \nonumber
    {1}/{\phi} &amp;\sim \text{Exponential}(2) \\ \nonumber
\end{align} \tag{2}</span></span></p>
</section>
<section id="prior-model-setup" class="level4">
<h4 class="anchored" data-anchor-id="prior-model-setup">Prior model setup</h4>
<p>Organize data needed to run the prior model.</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># total host population</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">14160</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># time steps </span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>n_days <span class="ot">=</span> <span class="dv">365</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>t <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, n_days, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>t0 <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>t <span class="ot">=</span> t[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co"># orgainize data for Stan </span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>data_seir <span class="ot">=</span> <span class="fu">list</span>(<span class="at">n_days =</span> n_days, </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">t0 =</span> t0, </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ts =</span> t, </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">N_h =</span> N, </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">N_v =</span> <span class="dv">300</span><span class="sc">*</span>N)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_seir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 5
 $ n_days: num 365
 $ t0    : num 0
 $ ts    : num [1:365] 1 2 3 4 5 6 7 8 9 10 ...
 $ N_h   : num 14160
 $ N_v   : num 4248000</code></pre>
</div>
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of MCMC steps</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>niter <span class="ot">=</span> <span class="dv">2000</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># number of chains, only a short run for prior model</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>num_chains <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># unique initial values for each chain</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>init_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, num_chains)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_chains) {</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  init_list[[i]] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">beta_h =</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">1</span>),</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">gamma_h =</span> <span class="fu">rlnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="fl">0.15</span>), <span class="fl">0.1</span>),</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sigma_h =</span> <span class="fu">rlnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="fl">0.17</span>), <span class="fl">0.1</span>),                         </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sigma_v =</span> <span class="fu">rlnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="fl">0.3</span>), <span class="fl">0.1</span>),</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">beta_v =</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">100</span>),</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mu_v =</span> <span class="fu">rlnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="fl">0.1</span>), <span class="fl">0.1</span>),</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">upsilon_h =</span> <span class="fu">rlnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="fl">0.25</span>), <span class="fl">0.1</span>),</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">upsilon_v =</span> <span class="fu">rlnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="fl">0.15</span>), <span class="fl">0.1</span>),   </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">i_0 =</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">e_0 =</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ev_0 =</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">iv_0 =</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="read-stan-model" class="level4">
<h4 class="anchored" data-anchor-id="read-stan-model">Read stan model</h4>
<p>The Stan code above is saved as a text file. It is read in to memory.</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>seirsei.st <span class="ot">=</span> <span class="fu">stan_model</span>(<span class="st">"inst/stan/vsv_prior.stan"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="run-prior-model" class="level4">
<h4 class="anchored" data-anchor-id="run-prior-model">Run prior model</h4>
<p>Data, model code, initial values are run. This model has been verified to run, however to reduce run time, a saved copy is loaded below.</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>prior_model <span class="ot">&lt;-</span> <span class="fu">sampling</span>(seirsei.st,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> data_seir,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">iter =</span> niter,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">chains =</span> num_chains,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>(),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">warmup =</span> <span class="dv">500</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">save_warmup =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">init =</span> init_list, </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">seed =</span> <span class="dv">1976</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>load saved model</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>prior_model <span class="ot">&lt;-</span> <span class="fu">get_data_osf</span>(<span class="st">"prior_model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>File downloaded successfully and saved as prior_model.rds </code></pre>
</div>
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(prior_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "stanfit"
attr(,"package")
[1] "rstan"</code></pre>
</div>
</div>
</section>
<section id="check-results" class="level4">
<h4 class="anchored" data-anchor-id="check-results">Check results</h4>
<p><strong>Parameter Distributions</strong><br>
Parameter distributions are plotted with medians as a visual check. In addition to parameters specified in prior distributions, the Extrinsic Incubation Period (<em>incub_v</em>), Intrinsic Incubation Period (<em>incub_h</em>), and basic reproduction number (R0_h) are shown in <a href="#fig-prior_params">Figure&nbsp;4</a>. The EIP and IIP are respectively calculated as the reciprocal of the estimated <span class="math inline">\sigma_v</span> and <span class="math inline">\sigma_h</span> parameters. The reproduction number (<span class="math inline">R_0</span>) is calculated as <span class="math inline">\beta_h \cdot \upsilon_h/\gamma_h</span>.</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_params_posteriors</span>(prior_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>No id variables; using all as measure variables</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-prior_params" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="overview_files/figure-html/fig-prior_params-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: Distributions from modeled priors. Dashed lines show the median value for each parameter.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><strong>Prior Predictive Distributions</strong> The prior model does not have information (data) about the number of observed number of VS cases, therefore predictions here (<a href="#fig-prior_traj">Figure&nbsp;5</a>) are based only on incidence as estimated from the SEIR-SEI ODE system and the prior distributions intended to capture mechanistic aspects of VS epidemiology. As a prior predictive check, it’s assumed that predictions will have considerable uncertainty, which is the case in <a href="#fig-prior_traj">Figure&nbsp;5</a>, however it is also case that the median counts across the random draws are near the truth.</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_sample_trajectories</span>(prior_model, <span class="at">truth_df=</span>truth_df, <span class="at">n_draws =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-prior_traj" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="overview_files/figure-html/fig-prior_traj-1.png" class="img-fluid figure-img" width="576"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5: Random draws from posterior predictive distribution. Blue lines show sampled trajectories exceeding the model estimated median values for each day, where as the height of the orange color gives the estimated daily median. Height of black points indicate observed daily incidence.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>To visualize the prior predictions differently, credible intervals can plotted along with the estimated median prediction (<a href="#fig-prior_ci">Figure&nbsp;6</a>).</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pred_incidence</span>(prior_model, <span class="at">my_truth =</span> truth_df)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-prior_ci" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="overview_files/figure-html/fig-prior_ci-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6: Figure displays summary credible intervals (blue shading) and medianprediction from the prior predictive model. Height of red points indicate observed daily incidence.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="full-bayesian-model" class="level3">
<h3 class="anchored" data-anchor-id="full-bayesian-model">Full Bayesian Model</h3>
<p>Although parameter values from the prior model are reasonable based on current understanding of VS epidmiology, draws from the prior predictive posterior show far too much uncertainty to have confidence in the model.</p>
<p>To improve the model, the Stan code is updated to include the following elements:</p>
<p><strong>Observed Incidence</strong><br>
The <code>data</code> block shown in the code is modfied to take observed incidence as an input. The observed incidence is referred to as <em>cases</em> in the code.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cases[n_days];</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>model</code> block is revised to include the observed cases when sampling from the NegBinomial.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>cases[<span class="dv">1</span>:(n_days<span class="dv">-1</span>)] ~ neg_binomial_2(incidence, phi);</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Observation Bias</strong><br>
In addition to incorporting observed incidence, the model a new model parameter is added to account for underreporting and other possible errors in the observations. The bias parameter is designated as <span class="math inline">\kappa</span> and used to reduce incidence as estimated by the SEIR-SEI system.</p>
<p>The new <span class="math inline">\kappa</span> parameter in the <code>transformed parameters</code> block,</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed parameters</span>{</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:n_days<span class="dv">-1</span>){</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    incidence[i] = -(y[i+<span class="dv">1</span>, <span class="dv">2</span>] - y[i, <span class="dv">2</span>] + y[i+<span class="dv">1</span>, <span class="dv">1</span>] - y[i, <span class="dv">1</span>])*kappa;</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and the <span class="math inline">\kappa</span> prior specification is added to the <code>model block</code>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  kappa ~ beta(<span class="dv">15</span>, <span class="dv">100</span>);</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With the addition of <span class="math inline">\kappa</span>, the previously described sampling distribution (<a href="#eq-negbin">Equation&nbsp;2</a>) becomes, <span class="math display">\begin{align} \nonumber
    \text{Y}_{t}|\theta &amp;\sim \text{NegBinomial}(\text{Y}|\Delta\text{I}_{t}\bold{\kappa}, \phi) \\ \nonumber
\end{align}</span></p>
<p><strong>Pointwise Log-Likelihood</strong><br>
Lastly, code is added to the <code>generated quantities</code> block to facilitate some checks after the model is run.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">generated quantities</span>{</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="dt">real</span> log_lik[n_days<span class="dv">-1</span>];</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:(n_days - <span class="dv">1</span>)) {</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    log_lik[i] = neg_binomial_2_lpmf(cases[i] | incidence[i], phi);</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The Stan code for the full Bayesian model, with the revisions decribed above can be viewed here:</p>
<section id="full-bayesian-model-results" class="level4">
<h4 class="anchored" data-anchor-id="full-bayesian-model-results">Full Bayesian model results</h4>
<p>The</p>
<div class="cell">

</div>
<div class="cell">

</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-right">Built with <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>